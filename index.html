<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ly Amadou">
<meta name="author" content="Baba Compaoré">
<meta name="author" content="Nguyen Huy Hoang">
<meta name="author" content="Bryan Foulla">
<meta name="dcterms.date" content="2025-04-01">

<title>Rapport du TER sur la Détection de fraude bancaire</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="rapport_initial_TER_files/libs/clipboard/clipboard.min.js"></script>
<script src="rapport_initial_TER_files/libs/quarto-html/quarto.js"></script>
<script src="rapport_initial_TER_files/libs/quarto-html/popper.min.js"></script>
<script src="rapport_initial_TER_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rapport_initial_TER_files/libs/quarto-html/anchor.min.js"></script>
<link href="rapport_initial_TER_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rapport_initial_TER_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rapport_initial_TER_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rapport_initial_TER_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rapport_initial_TER_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="rapport_initial_TER_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="rapport_initial_TER_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="rapport_initial_TER_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="rapport_initial_TER_files/libs/datatables-binding-0.33/datatables.js"></script>

<script src="rapport_initial_TER_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="rapport_initial_TER_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="rapport_initial_TER_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="rapport_initial_TER_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="rapport_initial_TER_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="rapport_initial_TER_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#contexte-et-motivation" id="toc-contexte-et-motivation" class="nav-link" data-scroll-target="#contexte-et-motivation"><span class="header-section-number">1.1</span> Contexte et motivation</a></li>
  <li><a href="#objectifs-du-projet" id="toc-objectifs-du-projet" class="nav-link" data-scroll-target="#objectifs-du-projet"><span class="header-section-number">1.2</span> Objectifs du projet</a></li>
  </ul></li>
  <li><a href="#analyse-exploratoire-des-données-eda" id="toc-analyse-exploratoire-des-données-eda" class="nav-link" data-scroll-target="#analyse-exploratoire-des-données-eda"><span class="header-section-number">2</span> Analyse exploratoire des données (EDA)</a>
  <ul class="collapse">
  <li><a href="#présentation-générale" id="toc-présentation-générale" class="nav-link" data-scroll-target="#présentation-générale"><span class="header-section-number">2.1</span> Présentation générale</a></li>
  <li><a href="#déséquilibre-des-classes" id="toc-déséquilibre-des-classes" class="nav-link" data-scroll-target="#déséquilibre-des-classes"><span class="header-section-number">2.2</span> Déséquilibre des classes</a></li>
  <li><a href="#analyse-univariée" id="toc-analyse-univariée" class="nav-link" data-scroll-target="#analyse-univariée"><span class="header-section-number">2.3</span> Analyse univariée</a>
  <ul class="collapse">
  <li><a href="#montant-des-transactions-amount" id="toc-montant-des-transactions-amount" class="nav-link" data-scroll-target="#montant-des-transactions-amount"><span class="header-section-number">2.3.1</span> Montant des transactions (<code>Amount</code>)</a></li>
  <li><a href="#temps-time" id="toc-temps-time" class="nav-link" data-scroll-target="#temps-time"><span class="header-section-number">2.3.2</span> Temps (<code>Time</code>)</a></li>
  </ul></li>
  <li><a href="#analyse-bivariée" id="toc-analyse-bivariée" class="nav-link" data-scroll-target="#analyse-bivariée"><span class="header-section-number">2.4</span> Analyse bivariée</a>
  <ul class="collapse">
  <li><a href="#variables-les-plus-discriminantes" id="toc-variables-les-plus-discriminantes" class="nav-link" data-scroll-target="#variables-les-plus-discriminantes"><span class="header-section-number">2.4.1</span> Variables les plus discriminantes</a></li>
  </ul></li>
  <li><a href="#corrélations" id="toc-corrélations" class="nav-link" data-scroll-target="#corrélations"><span class="header-section-number">2.5</span> Corrélations</a></li>
  </ul></li>
  <li><a href="#modélisation-machine-learning" id="toc-modélisation-machine-learning" class="nav-link" data-scroll-target="#modélisation-machine-learning"><span class="header-section-number">3</span> Modélisation Machine Learning</a>
  <ul class="collapse">
  <li><a href="#prétraitement-des-données" id="toc-prétraitement-des-données" class="nav-link" data-scroll-target="#prétraitement-des-données"><span class="header-section-number">3.1</span> Prétraitement des données</a></li>
  <li><a href="#entraînement-des-modèles" id="toc-entraînement-des-modèles" class="nav-link" data-scroll-target="#entraînement-des-modèles"><span class="header-section-number">3.2</span> Entraînement des modèles</a>
  <ul class="collapse">
  <li><a href="#évaluation-quelles-métriques-utiliser" id="toc-évaluation-quelles-métriques-utiliser" class="nav-link" data-scroll-target="#évaluation-quelles-métriques-utiliser"><span class="header-section-number">3.2.1</span> Évaluation : quelles métriques utiliser ?</a></li>
  </ul></li>
  <li><a href="#résultats-comparatifs" id="toc-résultats-comparatifs" class="nav-link" data-scroll-target="#résultats-comparatifs"><span class="header-section-number">3.3</span> Résultats comparatifs</a></li>
  </ul></li>
  <li><a href="#interprétation-des-modèles" id="toc-interprétation-des-modèles" class="nav-link" data-scroll-target="#interprétation-des-modèles"><span class="header-section-number">4</span> Interprétation des modèles</a>
  <ul class="collapse">
  <li><a href="#à-quoi-servent-les-valeurs-shap" id="toc-à-quoi-servent-les-valeurs-shap" class="nav-link" data-scroll-target="#à-quoi-servent-les-valeurs-shap"><span class="header-section-number">4.1</span> À quoi servent les valeurs SHAP ?</a>
  <ul class="collapse">
  <li><a href="#shap-pour-expliquer-une-prédiction" id="toc-shap-pour-expliquer-une-prédiction" class="nav-link" data-scroll-target="#shap-pour-expliquer-une-prédiction"><span class="header-section-number">4.1.1</span> SHAP : pour expliquer une prédiction</a></li>
  </ul></li>
  <li><a href="#exemples-concrets-dinterprétation" id="toc-exemples-concrets-dinterprétation" class="nav-link" data-scroll-target="#exemples-concrets-dinterprétation"><span class="header-section-number">4.2</span> Exemples concrets d’interprétation</a></li>
  </ul></li>
  <li><a href="#application-shiny" id="toc-application-shiny" class="nav-link" data-scroll-target="#application-shiny"><span class="header-section-number">5</span> Application Shiny</a>
  <ul class="collapse">
  <li><a href="#objectif-de-lapplication" id="toc-objectif-de-lapplication" class="nav-link" data-scroll-target="#objectif-de-lapplication"><span class="header-section-number">5.1</span> Objectif de l’application</a></li>
  <li><a href="#fonctionnalités-principales" id="toc-fonctionnalités-principales" class="nav-link" data-scroll-target="#fonctionnalités-principales"><span class="header-section-number">5.2</span> Fonctionnalités principales</a></li>
  </ul></li>
  <li><a href="#conclusion-et-perspectives" id="toc-conclusion-et-perspectives" class="nav-link" data-scroll-target="#conclusion-et-perspectives"><span class="header-section-number">6</span> Conclusion et perspectives</a>
  <ul class="collapse">
  <li><a href="#résumé" id="toc-résumé" class="nav-link" data-scroll-target="#résumé"><span class="header-section-number">6.1</span> Résumé</a></li>
  <li><a href="#limites" id="toc-limites" class="nav-link" data-scroll-target="#limites"><span class="header-section-number">6.2</span> Limites</a></li>
  </ul></li>
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références"><span class="header-section-number">7</span> Références</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rapport du TER sur la Détection de fraude bancaire</h1>
<p class="subtitle lead">Projet réalisé sous la direction de M. Laurent Rouvière</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Ly Amadou </p>
             <p>Baba Compaoré </p>
             <p>Nguyen Huy Hoang </p>
             <p>Bryan Foulla </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong><em>Projet réalisé sous la direction de M. Laurent Rouvière</em></strong></p>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="contexte-et-motivation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="contexte-et-motivation"><span class="header-section-number">1.1</span> Contexte et motivation</h2>
<p>La fraude bancaire représente un enjeu majeur pour les institutions financières. Elle se manifeste à travers diverses formes, notamment les fraudes par carte bancaire (vol, transactions suspectes) et celles non liées à la carte (usurpation d’identité, blanchiment d’argent). Avec la croissance exponentielle des transactions numériques, détecter efficacement ces fraudes est devenu crucial.</p>
<p>Le principal défi réside dans le déséquilibre des données : les fraudes sont rares, ce qui rend difficile la détection via des méthodes classiques. D’où l’intérêt du Machine Learning (ML), qui permet d’identifier des motifs subtils dans des volumes massifs de données.</p>
</section>
<section id="objectifs-du-projet" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="objectifs-du-projet"><span class="header-section-number">1.2</span> Objectifs du projet</h2>
<p>Ce projet a pour but de :</p>
<ul>
<li>Construire des modèles de classification pour détecter les fraudes.</li>
<li>Comparer plusieurs algorithmes de ML (LightGBM, XGBoost, CatBoost).</li>
<li>Interpréter les résultats à l’aide des valeurs SHAP.</li>
<li>Déployer une application web interactive via Shiny.</li>
</ul>
</section>
</section>
<section id="analyse-exploratoire-des-données-eda" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Analyse exploratoire des données (EDA)</h1>
<section id="présentation-générale" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="présentation-générale"><span class="header-section-number">2.1</span> Présentation générale</h2>
<p>Le dataset utilisé contient les transactions de carte bancaire effectuées en deux jours. Il comporte <strong>284 807 transactions</strong>, dont <strong>492 sont frauduleuses</strong> (~0.172%). Les données sont entièrement numériques, la plupart issues d’une analyse en composantes principales (PCA).</p>
<p>Les variables notables : - <code>Time</code> : secondes depuis la première transaction. - <code>Amount</code> : montant de la transaction. - <code>Class</code> : 1 si fraude, 0 sinon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"creditcard.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau interactif (arrondi)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(<span class="fu">round</span>(<span class="fu">describe</span>(df), <span class="dv">2</span>), </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>), </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">caption =</span> <span class="st">"Résumé statistique des variables"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-deafc5bccdf28285bab4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-deafc5bccdf28285bab4">{"x":{"filter":"none","vertical":false,"caption":"<caption>Résumé statistique des variables<\/caption>","data":[["Time","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","Amount","Class"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],[284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807,284807],[94813.86,0,0,-0,0,0,0,-0,0,-0,0,0,-0,0,0,0,0,-0,0,0,0,0,-0,0,0,0,0,-0,-0,88.34999999999999,0],[47488.15,1.96,1.65,1.52,1.42,1.38,1.33,1.24,1.19,1.1,1.09,1.02,1,1,0.96,0.92,0.88,0.85,0.84,0.8100000000000001,0.77,0.73,0.73,0.62,0.61,0.52,0.48,0.4,0.33,250.12,0.04],[84692,0.02,0.07000000000000001,0.18,-0.02,-0.05,-0.27,0.04,0.02,-0.05,-0.09,-0.03,0.14,-0.01,0.05,0.05,0.07000000000000001,-0.07000000000000001,-0,0,-0.06,-0.03,0.01,-0.01,0.04,0.02,-0.05,0,0.01,22,0],[95361.03,0.22,0.07000000000000001,0.09,-0.06,-0.03,-0.18,0.01,0.06,-0.03,-0.06,-0.01,0.1,-0,0.03,0.03,0.03,-0.04,0,0,-0.04,-0.02,0,-0.01,0.04,0.01,-0.03,0.01,0.01,41.64,0],[63256.61,1.77,1.04,1.39,1.19,0.97,0.83,0.83,0.38,0.92,0.71,1.11,0.75,0.97,0.68,0.91,0.73,0.65,0.74,0.68,0.25,0.31,0.8,0.23,0.59,0.5,0.42,0.12,0.1,29.98,0],[0,-56.41,-72.72,-48.33,-5.68,-113.74,-26.16,-43.56,-73.22,-13.43,-24.59,-4.8,-18.68,-5.79,-19.21,-4.5,-14.13,-25.16,-9.5,-7.21,-54.5,-34.83,-10.93,-44.81,-2.84,-10.3,-2.6,-22.57,-15.43,0,0],[172792,2.45,22.06,9.380000000000001,16.88,34.8,73.3,120.59,20.01,15.59,23.75,12.02,7.85,7.13,10.53,8.880000000000001,17.32,9.25,5.04,5.59,39.42,27.2,10.5,22.53,4.58,7.52,3.52,31.61,33.85,25691.16,1],[172792,58.86,94.77,57.71,22.56,148.54,99.45999999999999,164.15,93.22,29.03,48.33,16.82,26.53,12.92,29.74,13.38,31.44,34.42,14.54,12.81,93.92,62.03,21.44,67.34,7.42,17.81,6.12,54.18,49.28,25691.16,1],[-0.04,-3.28,-4.62,-2.24,0.68,-2.43,1.83,2.55,-8.52,0.55,1.19,0.36,-2.28,0.07000000000000001,-2,-0.31,-1.1,-3.84,-0.26,0.11,-2.04,3.59,-0.21,-5.88,-0.55,-0.42,0.58,-1.17,11.19,16.98,24],[-1.29,32.49,95.77,26.62,2.64,206.9,42.64,405.6,220.58,3.73,31.99,1.63,20.24,0.2,23.88,0.28,10.42,94.8,2.58,1.72,271.01,207.28,2.83,440.08,0.62,4.29,0.92,244.98,933.37,845.0700000000001,573.87],[88.98,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.47,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>vars<\/th>\n      <th>n<\/th>\n      <th>mean<\/th>\n      <th>sd<\/th>\n      <th>median<\/th>\n      <th>trimmed<\/th>\n      <th>mad<\/th>\n      <th>min<\/th>\n      <th>max<\/th>\n      <th>range<\/th>\n      <th>skew<\/th>\n      <th>kurtosis<\/th>\n      <th>se<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"vars","targets":1},{"name":"n","targets":2},{"name":"mean","targets":3},{"name":"sd","targets":4},{"name":"median","targets":5},{"name":"trimmed","targets":6},{"name":"mad","targets":7},{"name":"min","targets":8},{"name":"max","targets":9},{"name":"range","targets":10},{"name":"skew","targets":11},{"name":"kurtosis","targets":12},{"name":"se","targets":13}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 284807     31</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>Class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
284315    492 </code></pre>
</div>
</div>
</section>
<section id="déséquilibre-des-classes" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="déséquilibre-des-classes"><span class="header-section-number">2.2</span> Déséquilibre des classes</h2>
<p>On observe un fort déséquilibre entre les classes. Les fraudes représentent moins de 0.2% des observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="fu">factor</span>(Class))) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Répartition des classes"</span>, <span class="at">x =</span> <span class="st">"Classe"</span>, <span class="at">y =</span> <span class="st">"Nombre de transactions"</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non frauduleuse"</span>, <span class="st">"Fraude"</span>)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img alt= "boxplot des variables discriminantes"src="rapport_initial_TER_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interprétation :</strong> Ce déséquilibre justifie l’utilisation de techniques de rééchantillonnage et de métriques adaptées (F1-score, AUC-PR).</p>
</section>
<section id="analyse-univariée" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="analyse-univariée"><span class="header-section-number">2.3</span> Analyse univariée</h2>
<section id="montant-des-transactions-amount" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="montant-des-transactions-amount"><span class="header-section-number">2.3.1</span> Montant des transactions (<code>Amount</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> Amount)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution du montant des transactions"</span>, <span class="at">x =</span> <span class="st">"Montant"</span>, <span class="at">y =</span> <span class="st">"Fréquence"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rapport_initial_TER_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> Amount, <span class="at">fill =</span> <span class="fu">factor</span>(Class))) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Montant par type de transaction"</span>, <span class="at">x =</span> <span class="st">"Montant"</span>, <span class="at">fill =</span> <span class="st">"Classe"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rapport_initial_TER_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interprétation :</strong> Les fraudes se produisent souvent sur de faibles montants, mais il existe aussi quelques fraudes sur des montants élevés. Cela peut indiquer une stratégie d’évasion (petits montants invisibles) ou des tentatives opportunistes.</p>
</section>
<section id="temps-time" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="temps-time"><span class="header-section-number">2.3.2</span> Temps (<code>Time</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">fill =</span> <span class="fu">factor</span>(Class))) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transactions dans le temps"</span>, <span class="at">x =</span> <span class="st">"Temps (secondes)"</span>, <span class="at">fill =</span> <span class="st">"Classe"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rapport_initial_TER_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interprétation :</strong> Les fraudes ont tendance à se concentrer à certains moments. Cela pourrait correspondre à des périodes de moindre surveillance (heures creuses ?).</p>
</section>
</section>
<section id="analyse-bivariée" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="analyse-bivariée"><span class="header-section-number">2.4</span> Analyse bivariée</h2>
<section id="variables-les-plus-discriminantes" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="variables-les-plus-discriminantes"><span class="header-section-number">2.4.1</span> Variables les plus discriminantes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_selected <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(V10, V12, V14, Class)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df_melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(df_selected, <span class="at">id.vars =</span> <span class="st">"Class"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_melt, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Class), <span class="at">y =</span> value, <span class="at">fill =</span> <span class="fu">factor</span>(Class))) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplots des variables discriminantes"</span>, <span class="at">x =</span> <span class="st">"Classe"</span>, <span class="at">y =</span> <span class="st">"Valeur"</span>) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rapport_initial_TER_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interprétation :</strong> Les variables <code>V10</code>, <code>V12</code>, <code>V14</code> montrent une différence nette entre les deux classes. Elles seront probablement importantes pour les modèles prédictifs.</p>
</section>
</section>
<section id="corrélations" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="corrélations"><span class="header-section-number">2.5</span> Corrélations</h2>
<p>Pour éviter un traitement lourd, on prend un échantillon aléatoire.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sample_df <span class="ot">&lt;-</span> df[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="dv">10000</span>), ]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(sample_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"V"</span>)))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">tl.cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="rapport_initial_TER_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interprétation :</strong> Certaines variables issues de la PCA sont encore corrélées entre elles. Cela peut influencer certains modèles sensibles aux colinéarités.</p>
</section>
</section>
<section id="modélisation-machine-learning" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Modélisation Machine Learning</h1>
<section id="prétraitement-des-données" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="prétraitement-des-données"><span class="header-section-number">3.1</span> Prétraitement des données</h2>
<p>Le dataset est fortement déséquilibré : seulement 0,172 % des transactions sont frauduleuses. Cela pose problème pour les modèles de Machine Learning classiques, qui pourraient prédire “non fraude” tout le temps et avoir raison dans 99,8 % des cas… sans jamais détecter la moindre fraude.</p>
<p>Pour contrer cela, on applique des méthodes de <strong>rééquilibrage des données</strong> :</p>
<ul>
<li><strong>Oversampling</strong> : on “duplique” ou génère plus d’exemples de fraudes (classe minoritaire).</li>
<li><strong>Undersampling</strong> : on réduit le nombre d’exemples de transactions normales.</li>
<li><strong>Méthodes combinées</strong> : on fait un peu des deux.</li>
</ul>
<p>Ces techniques permettent aux modèles d’apprendre les schémas de fraude, même rares.</p>
</section>
<section id="entraînement-des-modèles" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="entraînement-des-modèles"><span class="header-section-number">3.2</span> Entraînement des modèles</h2>
<p>Nous avons entraîné plusieurs modèles d’apprentissage automatique : - <strong>XGBoost</strong> : basé sur les arbres de décision, efficace pour les données structurées. - <strong>LightGBM</strong> : similaire à XGBoost mais plus rapide sur les gros jeux de données. - <strong>CatBoost</strong> : bien adapté aux données catégorielles.</p>
<section id="évaluation-quelles-métriques-utiliser" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="évaluation-quelles-métriques-utiliser"><span class="header-section-number">3.2.1</span> Évaluation : quelles métriques utiliser ?</h3>
<p>Pour évaluer ces modèles, on utilise les <strong>métriques suivantes</strong> :</p>
<ul>
<li><strong>Précision (Precision)</strong> : parmi toutes les transactions identifiées comme fraude, combien le sont vraiment ?</li>
<li><strong>Rappel (Recall)</strong> : parmi toutes les fraudes réelles, combien ont été détectées ?</li>
<li><strong>F1-score</strong> : moyenne entre précision et rappel. Plus il est élevé, mieux le modèle équilibre ces deux critères.</li>
<li><strong>AUC-PR (Aire sous la courbe Précision-Rappel)</strong> : utile quand les classes sont déséquilibrées.</li>
<li><strong>MCC (Matthews Correlation Coefficient)</strong> : donne une vue d’ensemble robuste, même en cas de déséquilibre.</li>
</ul>
<p><code>{# Exemple illustratif :} # library(caret) # confusionMatrix(predictions, truth)</code></p>
</section>
</section>
<section id="résultats-comparatifs" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="résultats-comparatifs"><span class="header-section-number">3.3</span> Résultats comparatifs</h2>
<p>Les tests montrent que :</p>
<ul>
<li>L’<strong>oversampling</strong> améliore clairement la capacité du modèle à détecter les fraudes.</li>
<li>Le <strong>modèle XGBoost</strong> (avec réglage de seuil) donne le meilleur F1-score.</li>
<li>LightGBM reste une bonne alternative, plus rapide mais un peu moins stable.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation disponible dans l'application via radar chart</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="interprétation-des-modèles" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Interprétation des modèles</h1>
<section id="à-quoi-servent-les-valeurs-shap" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="à-quoi-servent-les-valeurs-shap"><span class="header-section-number">4.1</span> À quoi servent les valeurs SHAP ?</h2>
<p>Les <strong>valeurs SHAP (SHapley Additive exPlanations)</strong> permettent de comprendre comment un modèle prend ses décisions. C’est très utile car les modèles comme XGBoost ou LightGBM sont souvent vus comme des “boîtes noires”.</p>
<section id="shap-pour-expliquer-une-prédiction" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="shap-pour-expliquer-une-prédiction"><span class="header-section-number">4.1.1</span> SHAP : pour expliquer une prédiction</h3>
<ul>
<li><strong>Globale</strong> : quelles variables sont les plus importantes dans l’ensemble des prédictions ?</li>
<li><strong>Locale</strong> : pour une transaction donnée, quelles variables ont pesé dans la balance ?</li>
</ul>
<p><code>{# shapviz ou SHAPforxgboost} # shap.plot.summary(shap_values)</code></p>
</section>
</section>
<section id="exemples-concrets-dinterprétation" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="exemples-concrets-dinterprétation"><span class="header-section-number">4.2</span> Exemples concrets d’interprétation</h2>
<ul>
<li>La variable <strong>V14</strong> est très discriminante : des valeurs faibles de V14 sont souvent liées à des fraudes.</li>
<li>La variable <strong>V10</strong> a un rôle clé dans la détection.</li>
<li>Grâce à SHAP, on peut visualiser pourquoi une transaction a été classée comme frauduleuse → utile pour les analystes et les banques.</li>
</ul>
<p><code>{# shap.plot.force(...)}</code></p>
<hr>
</section>
</section>
<section id="application-shiny" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Application Shiny</h1>
<section id="objectif-de-lapplication" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="objectif-de-lapplication"><span class="header-section-number">5.1</span> Objectif de l’application</h2>
<p>Permettre aux utilisateurs (data analysts, professeurs, étudiants) d’explorer les données, les modèles et leurs résultats de manière interactive.</p>
</section>
<section id="fonctionnalités-principales" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="fonctionnalités-principales"><span class="header-section-number">5.2</span> Fonctionnalités principales</h2>
<ul>
<li>Onglet <strong>Exploration</strong> : visualiser les données, analyser les montants et fréquences</li>
<li>Onglet <strong>Modélisation</strong> : comparer les scores des modèles (graphiques radar)</li>
<li>Onglet <strong>SHAP</strong> : comprendre l’importance des variables</li>
<li>Onglet <strong>Présentation</strong> : explication du contexte et du projet</li>
</ul>
<hr>
</section>
</section>
<section id="conclusion-et-perspectives" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion et perspectives</h1>
<section id="résumé" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="résumé"><span class="header-section-number">6.1</span> Résumé</h2>
<ul>
<li>Nous avons traité un problème de classification avec données très déséquilibrées.</li>
<li>Une analyse exploratoire rigoureuse nous a permis d’identifier les variables clés.</li>
<li>Le modèle XGBoost équilibré a obtenu de très bons résultats.</li>
<li>L’interprétation via SHAP a rendu le modèle plus transparent.</li>
</ul>
</section>
<section id="limites" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="limites"><span class="header-section-number">6.2</span> Limites</h2>
<ul>
<li>Les variables étant anonymisées (via ACP), il est difficile de leur donner un sens métier.</li>
<li>Les modèles sont statiques : ils ne s’adaptent pas automatiquement à de nouvelles fraudes.</li>
</ul>
</section>
</section>
<section id="références" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Références</h1>
<ul>
<li><p>Handbook of Fraud Detection <a href="https://fraud-detection-handbook.github.io/fraud-detection-handbook" class="uri">https://fraud-detection-handbook.github.io/fraud-detection-handbook</a></p></li>
<li><p>Interpretable Machine Learning (Christoph Molnar) – Chapitre SHAP <a href="https://christophm.github.io/interpretable-ml-book/shap.html" class="uri">https://christophm.github.io/interpretable-ml-book/shap.html</a></p></li>
<li><p>Documentation SHAP : <a href="https://github.com/slundberg/shap" class="uri">https://github.com/slundberg/shap</a></p></li>
</ul>
<p>quarto render ton_fichier.qmd –to pdf<br>
<br>
</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
